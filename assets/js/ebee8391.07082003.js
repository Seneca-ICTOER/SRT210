"use strict";(self.webpackChunkSRT210=self.webpackChunkSRT210||[]).push([[659],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),h=a,m=d["".concat(s,".").concat(h)]||d[h]||p[h]||o;return n?r.createElement(m,i(i({ref:t},c),{},{components:n})):r.createElement(m,i({ref:t},c))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6594:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return i},default:function(){return p},frontMatter:function(){return o},metadata:function(){return l},toc:function(){return u}});var r=n(3117),a=(n(7294),n(3905));const o={id:"lab4",title:"Lab 4",sidebar_position:4,description:"Lab 4"},i="Lab 4",l={unversionedId:"A-Labs/lab4",id:"A-Labs/lab4",title:"Lab 4",description:"Lab 4",source:"@site/docs/A-Labs/lab4.md",sourceDirName:"A-Labs",slug:"/A-Labs/lab4",permalink:"/SRT210/A-Labs/lab4",draft:!1,editUrl:"https://github.com/Seneca-ICTOER/SRT210/tree/main/docs/A-Labs/lab4.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"lab4",title:"Lab 4",sidebar_position:4,description:"Lab 4"},sidebar:"courseNotesSidebar",previous:{title:"Lab 3",permalink:"/SRT210/A-Labs/lab3"},next:{title:"Lab 4 Part 2",permalink:"/SRT210/A-Labs/lab4-part2"}},s={},u=[{value:"Objectives",id:"objectives",level:2},{value:"Part 1: Prerequisites",id:"part-1-prerequisites",level:2},{value:"Part 2: DNS Overview",id:"part-2-dns-overview",level:2},{value:"Part 3: Your Own DNS Server",id:"part-3-your-own-dns-server",level:2},{value:"Set up /etc/named.conf",id:"set-up-etcnamedconf",level:3},{value:"Set up the zone file",id:"set-up-the-zone-file",level:3},{value:"Configure the firewall",id:"configure-the-firewall",level:3},{value:"DNS Client Configuration",id:"dns-client-configuration",level:3},{value:"Lab Completion",id:"lab-completion",level:2}],c={toc:u};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"lab-4"},"Lab 4"),(0,a.kt)("h2",{id:"objectives"},"Objectives"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Understand the principles of how DNS works."),(0,a.kt)("li",{parentName:"ul"},"Set up an authoritative DNS server."),(0,a.kt)("li",{parentName:"ul"},"Test your DNS server to confirm that it works as expected."),(0,a.kt)("li",{parentName:"ul"},"Configure an operating system to use a specific DNS server.")),(0,a.kt)("h2",{id:"part-1-prerequisites"},"Part 1: Prerequisites"),(0,a.kt)("p",null,"You should have completed all the previous labs to date. That means before starting this lab you'll have:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"c7host set up and running, with the default firewall modified to allow incoming SSH connections from the 192.168.210.0/24 network."),(0,a.kt)("li",{parentName:"ul"},"lin1 with a static IP address, running a web server, and the default firewall modified to allow access to that web server."),(0,a.kt)("li",{parentName:"ul"},"lin2 with a static IP address."),(0,a.kt)("li",{parentName:"ul"},"All your machines should have iptables services installed and firewalld uninstaled (or at least disabled and stopped).")),(0,a.kt)("p",null,"If any of that is not working for you already - you will struggle more than needed while debugging configuration issues in this lab."),(0,a.kt)("h2",{id:"part-2-dns-overview"},"Part 2: DNS Overview"),(0,a.kt)("p",null,"DNS is technically not a required part of the internet, but effectively it's indispensable for nearly all services of every sort on the internet. We'll spend a couple of weeks on topics related to DNS."),(0,a.kt)("p",null,"Read sections 1-13 from the ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikibooks.org/wiki/Communication_Networks/DNS"},"Wikibooks DNS page"),"."),(0,a.kt)("h2",{id:"part-3-your-own-dns-server"},"Part 3: Your Own DNS Server"),(0,a.kt)("p",null,"Each of you will set up your own DNS server. We'll set up Bind on lin2 to do the work. The domains you configure will work for you or anyone who explicitly sets up their systems to use your DNS server. They will not work on the internet, because you'd have to pay a registrar to have your domain/server globally registered."),(0,a.kt)("p",null,"Install Bind on your ",(0,a.kt)("strong",{parentName:"p"},"lin2"),"."),(0,a.kt)("p",null,"An ",(0,a.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Domain_Name_System#Authoritative_name_server"},"authoritative")," Bind server has a global configuration file (named.conf) and at least one zone file for the zone it's authoritative for."),(0,a.kt)("h3",{id:"set-up-etcnamedconf"},"Set up /etc/named.conf"),(0,a.kt)("p",null,"When you install Bind you'll get a default ",(0,a.kt)("strong",{parentName:"p"},"/etc/named.conf"),". Copy this file over to a backup location and empty the original (do not delete or move it as that will cause SELinux not to trust it). We will be writing one from scratch with only the following contents, but use your own X value where applicable."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'options {\n        directory "/var/named/";\n        allow-query {any;};\n        forwarders { 208.67.222.222; };\n};\n\nlogging {\n        channel default_debug {\n                file "data/named.run";\n                severity dynamic;\n        };\n    channel my_queries_channel {\n        file "queries/log.txt";\n        severity info;\n    };\n    category queries {\n        my_queries_channel;\n    };\n};\n\nzone "localhost" {\n        type master;\n        file "named.localhost";\n};\nzone "yoursenecaid.ops" {\n        type master;\n        file "mydb-for-yoursenecaid-ops";\n};\n')),(0,a.kt)("p",null,"You need to understand all the options in this file except the localhost zone, so that in the future (for example in a test) you can quickly set up a DNS server for a new zone. So look up in ",(0,a.kt)("a",{parentName:"p",href:"http://www.zytrax.com/books/dns/ch7/statements.html"},"the reference")," these things and write down what they do:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"directory")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"allow-query")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"forwarders")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"type")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"file"))),(0,a.kt)("p",null,"Create the directory and the log file for logging queries:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir /var/named/queries\ntouch /var/named/queries/log.txt\nchown root:named /var/named/queries\nchown named:named /var/named/queries/log.txt\nchmod 770 /var/named/queries \nchmod 644 /var/named/queries/log.txt\n")),(0,a.kt)("p",null,"If you have SELinux enabled, you need to set the proper file context for the direcotry and the log file using the following two commands:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"chcon system_u:object_r:named_cache_t:s0 /var/named/queries\nchcon system_u:object_r:named_cache_t:s0 /var/named/queries/log.txt\n")),(0,a.kt)("p",null,'The "ls -lZ" command lists the file context.'),(0,a.kt)("h3",{id:"set-up-the-zone-file"},"Set up the zone file"),(0,a.kt)("p",null,"Now edit ",(0,a.kt)("strong",{parentName:"p"},"/var/named/mydb-for-yoursenecaid-ops")," and enter the following:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$TTL    3D\n@       IN      SOA     lin2.yoursenecaid.ops.      hostmaster.yoursenecaid.ops.(\n                2018042901       ; Serial\n                8H      ; Refresh\n                2H      ; Retry\n                1W      ; Expire\n                1D      ; Negative Cache TTL\n);\n@       IN      NS      lin2.yoursenecaid.ops.\nc7host  IN      A       192.168.210.1\n")),(0,a.kt)("p",null,"Again, here's the ",(0,a.kt)("a",{parentName:"p",href:"http://www.zytrax.com/books/dns/ch8/"},"reference documentation")," for records in this file. Specifically pay attention to:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"A")," records"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"NS")," records"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"SOA")," records")),(0,a.kt)("p",null,"Now that your DNS server (bind, a.k.a. named) is configured:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Start the ",(0,a.kt)("strong",{parentName:"li"},"named")," service with the ",(0,a.kt)("strong",{parentName:"li"},"systemctl")," command."),(0,a.kt)("li",{parentName:"ol"},"Check that the ",(0,a.kt)("em",{parentName:"li"},"named")," service is running using the ",(0,a.kt)("strong",{parentName:"li"},"ps ax")," command (perhaps combined with ",(0,a.kt)("strong",{parentName:"li"},"grep"),"), and separately, the ",(0,a.kt)("strong",{parentName:"li"},"systemctl")," command (if necessary), or check the ",(0,a.kt)("strong",{parentName:"li"},"/var/log/messages")," file for troubleshooting purposes."),(0,a.kt)("li",{parentName:"ol"},"Once you are certain that the ",(0,a.kt)("em",{parentName:"li"},"named")," service had started and runs without errors, then set it to ",(0,a.kt)("strong",{parentName:"li"},"start automatically")," (i.e. enable the named service) when this virtual machine boots."),(0,a.kt)("li",{parentName:"ol"},"Now that you know the service works, ",(0,a.kt)("strong",{parentName:"li"},"add the resource records necessary for it to provide forward lookups of the other machines in your virtual network")," (hint: You should only need two more records) and restart the service."),(0,a.kt)("li",{parentName:"ol"},"Test the server on lin2 using the dig command, for example:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"dig c7host.andrew.ops @192.168.210.12\n")),(0,a.kt)("h3",{id:"configure-the-firewall"},"Configure the firewall"),(0,a.kt)("p",null,"The DNS server on lin2 won't be accessible by default even if it's working perfectly because the firewall will not allow access to it."),(0,a.kt)("p",null,"Add a rule to the appropriate chain to allow access to the service. You'll need to first figure out the protocol and port that is used by DNS queries."),(0,a.kt)("h3",{id:"dns-client-configuration"},"DNS Client Configuration"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Configure c7host to use lin2 as the DNS server. You can always change that back if you need internet access and your DNS server is broken:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Edit the ifcfg file for your interface on c7host (/etc/sysconfig/network-scripts/ifcfg-ens33) and add ",(0,a.kt)("inlineCode",{parentName:"li"},"PEERDNS=NO")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"DNS1=192.168.210.12")),(0,a.kt)("li",{parentName:"ul"},"Bring your interface down and back up using the ifdown and ifup commands."))),(0,a.kt)("li",{parentName:"ul"},"Try this to verify that you set-up your DNS server correctly:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"host c7host.yoursenecaid.ops\nhost lin1.yoursenecaid.ops\nhost lin2.yoursenecaid.ops\nhost google.ca\n")),(0,a.kt)("h2",{id:"lab-completion"},"Lab Completion"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Make sure you understand what you've done in this lab, so that you're ready to answer questions about it."),(0,a.kt)("li",{parentName:"ul"},"Have notes in your labbook from this lab."),(0,a.kt)("li",{parentName:"ul"},"Show your work to the professor and have them sign your labbook.")))}p.isMDXComponent=!0}}]);