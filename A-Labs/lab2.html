<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-A-Labs/lab2">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/SRT210/img/pwa/icon-512x512.png">
<link rel="manifest" href="/SRT210/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/SRT210/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/SRT210/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/SRT210/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Lab 2 | SRT210 - Infrastructure Administration</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab2"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 2 | SRT210 - Infrastructure Administration"><meta data-rh="true" name="description" content="Lab 2"><meta data-rh="true" property="og:description" content="Lab 2"><link data-rh="true" rel="icon" href="/SRT210/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab2"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab2" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab2" hreflang="x-default"><link rel="stylesheet" href="/SRT210/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/SRT210/assets/js/runtime~main.e02e2a8f.js" as="script">
<link rel="preload" href="/SRT210/assets/js/main.beb789c5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/SRT210/"><div class="navbar__logo"><img src="/SRT210/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/SRT210/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SRT210 - Infrastructure Administration</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SRT210/">Welcome to SRT210</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SRT210/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/SRT210/A-Labs/lab1">Labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab1">Lab 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/SRT210/A-Labs/lab2">Lab 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab3">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab4">Lab 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab4-part2">Lab 4 Part 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab5">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab6">Lab 6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab7">Lab 7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab8">Lab 8</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SRT210/B-Assignments/assignment1">Assignments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SRT210/C-ExtraResources/first-half-review">Extra Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/SRT210/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Labs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 2</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objectives">Objectives<a class="hash-link" href="#objectives" title="Direct link to heading">​</a></h2><ul><li>Set up a nested virtual machine</li><li>Get familiar with basic networking setup and utilities used on Linux</li><li>Understand how the IPtables firewall works and use it to make simple rules</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-nested-virtual-machine">Part 1: Nested Virtual Machine<a class="hash-link" href="#part-1-nested-virtual-machine" title="Direct link to heading">​</a></h2><p>Since we&#x27;re forced to use a Windows machine as the main VM host, we&#x27;re going to have to set up nested virtualisation. Luckily that&#x27;s not too difficult.</p><ul><li>Change the settings for your c7host to have at least 4GB of RAM (8 would be better), and enable &quot;Virtual Intel VT-X/EPT or AMD-V/RVI&quot; under VM/Settings/Processors.</li><li>Install the following packages: qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer bridge-utils</li><li>Make sure (using <code>systemctl status</code>) that the libvirtd service starts at boot.</li><li>Those will include both the KVM hypervisor and Virt Manager, which is a graphical tool used to administer it.</li><li>Create a new virtual machine with the following settings:<ul><li>Will be installed from the network: <a href="https://mirror.senecacollege.ca/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">https://mirror.senecacollege.ca/centos/7/os/x86_64/</a> or <a href="http://mirror.netflash.net/centos/7/os/x86_64/" target="_blank" rel="noopener noreferrer">http://mirror.netflash.net/centos/7/os/x86_64/</a></li><li>2GB of RAM (needed for installation, you should change it to 512MB after the install is done)</li><li>10GB of disk</li><li>NAT for networking</li><li>hostname lin1</li><li>Minimal install</li></ul></li></ul><p>After you&#x27;re done - you&#x27;ll have a command-line-only CentOS machine (lin1) running inside a graphical CentOS desktop (c7host).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-basic-networking">Part 2: Basic Networking<a class="hash-link" href="#part-2-basic-networking" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="simple-commands">Simple commands<a class="hash-link" href="#simple-commands" title="Direct link to heading">​</a></h3><p>Use these commands to check the curent network settings on lin1:</p><ul><li>ip link (show interfaces)</li><li>ip address (the MAC address, IP address, and subnet mask for every interface)</li><li>ip route (the routing table)</li><li>cat /etc/resolv.conf (the DNS server you&#x27;re configured to query)</li><li>arp -n (the ARP table)</li></ul><p>Note if you&#x27;re missing a command - you can figure out what package contains in by using <code>yum whatprovides</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-virtual-network">New virtual network<a class="hash-link" href="#new-virtual-network" title="Direct link to heading">​</a></h3><p>By default a KVM setup has a NAT network with a DHCP server. That works nicely out of the box but won&#x27;t work for us because we&#x27;ll need to configure network settings manually.</p><ol><li>Power off lin1</li><li>In the <strong>Connection Details</strong> dialog box, select the <strong>Virtual Networks</strong> tab</li><li>Click to de-select the <strong>Autostart (on boot)</strong> check-box options and click the <strong>Apply</strong> button.</li><li>Stop the default network by clicking on the <strong>stop</strong> button at the bottom left-side of the dialog box.</li><li>Click the <strong>add</strong> button to add a new network configuration.</li><li>Leave the default network name <strong>network1</strong>.</li><li>In the next screen, enter the <strong>new network IP address space</strong> called: <strong>192.168.210.0/24</strong></li><li>Disable <strong>DHCPv4</strong></li><li>Enable Network Forwarding by Selecting <strong>Forwarding to physical network</strong>, the destination should be <strong>Any physical device</strong> and the mode should be <strong>NAT</strong></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-settings-on-lin1">Network settings on lin1<a class="hash-link" href="#network-settings-on-lin1" title="Direct link to heading">​</a></h3><ul><li>Now if you try to start lin1 - it will tell you that the network &quot;default&quot; is unavailable. Go into the lin1 VM settings and configure the NIC to use &quot;network1&quot; instead.</li><li>After starting the VM you&#x27;ll find that your network interface is not configured (try all the commands above again to see their output).</li><li>Configure your wired interface by editing the file as described in the steps below.</li><li>Change to the <strong>/etc/sysconfig/network-scripts</strong> directory.</li><li>List the contents of this directory. You should see 2 different types of files, network config scripts and network configuration files.</li><li>Look for the configuration file for your interface. It should have the name of the interface in the filename and the interface&#x27;s MAC address in its contents.</li><li>Edit that file and give it the following settings:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">DEVICE</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IPADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.210.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">NETMASK</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">255.255</span><span class="token plain">.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">GATEWAY</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.210.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">HWADDR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">xx:xx:xx:xx:xx:xx </span><span class="token comment" style="color:#999988;font-style:italic"># Make sure it&#x27;s the right MAC address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">DNS1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.210.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">BOOTPROTO</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">ONBOOT</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">NM_CONTROLLED</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">IPV6INIT</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">no</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Ask yourself where did the IP address 192.168.210.1 come from and why it&#x27;s your default gateway and DNS server.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-iptables">Part 3: iptables<a class="hash-link" href="#part-3-iptables" title="Direct link to heading">​</a></h2><p>CentOS comes with firewalld installed by default. We will not be using that, instead we&#x27;ll do all our firewall work with iptables. Therefore we&#x27;ll need to uninstall firewalld and install iptables management tools:</p><ul><li>Use <strong>systemctl</strong> to stop <strong>firewalld</strong> and disable it from starting on boot.</li><li>Use <strong>yum</strong> to uninstall <strong>firewalld</strong> and <strong>install iptables-services</strong></li><li>Use <strong>systemctl</strong> to start the <strong>iptables service</strong> and configure it to be started on boot.</li><li>Run <code>iptables -L</code>. We will be learning how to read that mess in the next section.</li></ul><p>IPtables is a complex system, and there&#x27;s a lot of material this week to cover it. Keep in mind as you&#x27;re going through the lab that you&#x27;re trying to learn three things:</p><ul><li><strong>How iptables works</strong></li><li><strong>How to understand the current state of the firewall</strong></li><li><strong>How to make useful changes to the firewall</strong></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iptables-overview">IPtables overview<a class="hash-link" href="#iptables-overview" title="Direct link to heading">​</a></h3><p>We will use an example of setting up a firewall on a web server.</p><p><img loading="lazy" alt="iptables" src="/SRT210/assets/images/Iptables-41593960263c3f4ed47eb8000073c778.png" width="560" height="350" class="img_ev3q"></p><p><strong>There are some important things to be aware of in terms of this diagram:</strong></p><ul><li>There are <strong>two sets of IPtables rules (chains) that apply: OUTPUT/INPUT on the client</strong> and <strong>INPUT/OUTPUT on the server</strong>. It is important to think about trafic from the perspective from the client as well as the server.</li><li><strong>Outbound traffic is rarely blocked unless there is a security policy to prevent some kind of traffic.</strong> Even in that case, that security policy is usually performed on a router.</li><li><strong>Inbound traffic is of two distinct types</strong>. Our diagram shows:<ol><li><strong>New incoming connections</strong> (what you normally think of as <strong>inbound traffic</strong>): the web server receives a <strong>new incoming connection</strong>.</li><li><strong>Incoming data that client receives as a response from the server</strong>: the web page that the server sent back in the diagram above.<ul><li>The analogy would be like making a <strong>telephone call</strong>:<ul><li>A <strong>NEW</strong> packet is like the phone ringing</li><li>An <strong>ESTABLISHED</strong> packet is the connection and the packet says &quot;hello&quot;, along with any further communication.</li><li>A <strong>RELATED</strong> packet would be the same person calling on a second line. (eg. a second connection that is made because of something that happened in the first, like an ftp transfer).</li></ul></li><li>We normally don&#x27;t want to do anything special for the response. It is safe to assume that <strong>a connection that was allowed to be established should be allowed to receive a response</strong>. This is accomplished with the following <strong>INPUT chain rule</strong> that should be there by default on your machines:</li></ul></li></ol></li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><strong>Rules are applied to: chains</strong> (e.g. <em>input/output</em>) and contain information regarding the type of traffic they apply to. For example, <strong>protocols</strong> such as <em>tcp/udp/icmp</em>, <strong>port numbers</strong> such as <em>22 (SSH)</em>, <em>80 (HTTP)</em>, <em>443 (HTTPS)</em>, <strong>addresses</strong>, and many other things.<ul><li>Let&#x27;s look at how these rules would apply to a simple web connection (HTTP - port 80):<ol><li>For the <em>request</em> (originating from browser on local machine), the <strong>source port (sport) for the example in the above diagram is 40112 (browser on local machine)</strong> and the <strong>destination port (dport) is 80 (webserver on remote machine)</strong></li><li>For the <em>response</em> (originating from server on remote machine), the <strong>source port (sport) is 80 (webserver on remote machine)</strong> and the <strong>destination port (dport) is 40112 (browser on local machine)</strong></li><li>Since the <strong>RELATED</strong>,<strong>ESTABLISHED</strong> rule already exists, we are only concerned about <strong>controlling</strong> the <strong>incoming traffic on the server</strong>, which in our example, the <strong>chain is: INPUT</strong>, the <strong>protocol is: tcp</strong>, and the <strong>destination is: port 80.</strong></li></ol></li></ul></li><li>Most other services work in a similar way as discussed above.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-rule">Adding a rule<a class="hash-link" href="#adding-a-rule" title="Direct link to heading">​</a></h3><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I OUTPUT  -p tcp -s0/0 -d </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/0 --dport </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> -j DROP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Can be read like this: <em>Insert a rule into the iptables OUTPUT chain that will match any tcp packet, with any a source address, any destination address, and a deistination port of 80. Any packet that matches will be dropped.</em></p><p>Let&#x27;s break down the command displayed above to see how it works:</p><table><thead><tr><th>Command</th><th>Breakdown</th></tr></thead><tbody><tr><td><strong>-I</strong></td><td>Tells iptables to INSERT this line into the OUTPUT policy. This means it will be the first line in the policy. If we used a <strong>-A</strong> switch it would have appended the line and it would be the last line of the policy. If you are writing complex iptables rules where multiple matches can occur, it is important that the lines go in the right order. If you follow the -I with a number, the new rule will be inserted at that location in the chain (for example, <code>-I 3 OUTPUT</code> will insert the rule into the 3rd position in the OUTPUT chain, moving the existing rules down as necessary (the old rule #3 will become the new rule #4, for example)</td></tr><tr><td><strong>-p tcp</strong></td><td>Tells iptables to only match TCP packets. Alternately, the protocol could be set to <strong>udp</strong>, <strong>icmp</strong>, or <strong>all</strong></td></tr><tr><td><strong>-s0/0</strong></td><td>Specifies the source IP address. 0/0 means a source address of “anywhere.” this has been put into the lab because your ip address will change because it is dynamically assigned. You can change this value if you want to the IP address that has been specifically assigned to your PC</td></tr><tr><td><strong>-d0/0</strong></td><td>Specifies the destination address. It makes sense that this address is set to “anywhere” because if we want to block all requests to the WWW, we will never know the specific IP address of web server that is trying to be accessed</td></tr><tr><td><strong>--dport 80</strong></td><td>Tells iptables to look at the destination port in the packet and see if it is equal to 80. Alternately, you can filter based on source addresses using the <code>--sport</code> switch</td></tr><tr><td><strong>-j</strong></td><td>Means when condition is met, then jump to a particular target – Basic targets are <strong>ACCEPT</strong>, <strong>DROP</strong>, <strong>REJECT</strong>, and <strong>LOG</strong>. The available targets depend on which table contains the chain</td></tr><tr><td><strong>DROP</strong></td><td>Means drop the packet – make it disappear - and do not continue processing rules. <strong>REJECT</strong> is similar, but causes an error packet to be sent back to the source host. <strong>ACCEPT</strong> causes the packet to be processed. LOG causes an entry to be made in the system logs showing that the packet was processed. Note that the <strong>LOG</strong> target is the only one that does not stop rule-checking in the chain - so you can log a packet with one rule, and then use a later rule in the chain to DROP, REJECT, or ACCEPT it</td></tr></tbody></table><p>To play with this:</p><ul><li>Install the Apache web server on lin1 (the package is called httpd).</li><li>Enable and start that service.</li><li>Install elinks (a command-line web browser) and see if you can connect to http://localhost (it should work by default).</li><li>Using Firefox on c7host, check whether you can view the same webpage in lin1 (by default you wont).</li><li>Next, check the iptables rules in lin1 and try to figure out why Firefox could not connect from c7host by reading the output of <code>iptables -L</code> on lin1 carefully looking for clues whether lin1 is letting inbound http traffic (TCP port 80) through.</li><li>If the output of <code>iptables -L</code> on lin1 isn&#x27;t letting HTTP traffic through, which by default it does not, add a rule to the iptables in lin1 to allow inbound traffic to pass through to Apache (TCP port 80).</li><li>Go back to c7host after verifing lin1 permits http traffic and once again test whether Firefox on c7host displays the webpage (you may need to give Firefox the IP address of lin1 to view the webpage). Now it should.</li></ul><p>If you make such a mess that you don&#x27;t know what you did any longer, there are a couple of things that can help you get back to normal:</p><ul><li>iptables --flush will erase all the rules</li><li>Restarting the iptables service will revert all the rules to the defaults.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-4-your-tasks">Part 4: Your Tasks<a class="hash-link" href="#part-4-your-tasks" title="Direct link to heading">​</a></h2><p>Use what you learned so far and what you can learn online in order to set up the following:</p><ol><li>lin1 will allow access to Apache from any source.</li><li>c7host will allow access to SSH from hosts on the 192.168.210.<!-- -->*<!-- --> subnet and deny it from any other source.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-completion">Lab Completion<a class="hash-link" href="#lab-completion" title="Direct link to heading">​</a></h2><ul><li>Make sure you understand what you&#x27;ve done in this lab, so that you&#x27;re ready to answer questions about it.</li><li>Have notes in your labbook from this lab.</li><li>Show your work to the professor and have them sign your labbook.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/SRT210/tree/main/docs/A-Labs/lab2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/SRT210/A-Labs/lab1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/SRT210/A-Labs/lab3"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 3</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objectives" class="table-of-contents__link toc-highlight">Objectives</a></li><li><a href="#part-1-nested-virtual-machine" class="table-of-contents__link toc-highlight">Part 1: Nested Virtual Machine</a></li><li><a href="#part-2-basic-networking" class="table-of-contents__link toc-highlight">Part 2: Basic Networking</a><ul><li><a href="#simple-commands" class="table-of-contents__link toc-highlight">Simple commands</a></li><li><a href="#new-virtual-network" class="table-of-contents__link toc-highlight">New virtual network</a></li><li><a href="#network-settings-on-lin1" class="table-of-contents__link toc-highlight">Network settings on lin1</a></li></ul></li><li><a href="#part-3-iptables" class="table-of-contents__link toc-highlight">Part 3: iptables</a><ul><li><a href="#iptables-overview" class="table-of-contents__link toc-highlight">IPtables overview</a></li><li><a href="#adding-a-rule" class="table-of-contents__link toc-highlight">Adding a rule</a></li></ul></li><li><a href="#part-4-your-tasks" class="table-of-contents__link toc-highlight">Part 4: Your Tasks</a></li><li><a href="#lab-completion" class="table-of-contents__link toc-highlight">Lab Completion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">SRT210 - Infrastructure Administration</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/SRT210/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seneca College.</div></div></div></footer></div>
<script src="/SRT210/assets/js/runtime~main.e02e2a8f.js"></script>
<script src="/SRT210/assets/js/main.beb789c5.js"></script>
</body>
</html>