<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-A-Labs/lab3">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<link rel="icon" href="/SRT210/img/pwa/icon-512x512.png">
<link rel="manifest" href="/SRT210/manifest.json">
<meta name="theme-color" content="#DA291C">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#DA291C">
<link rel="apple-touch-icon" href="/SRT210/img/pwa/icon-192x192.png">
<link rel="mask-icon" href="/SRT210/img/pwa/icon-512x512.png" color="#DA291C">
<meta name="msapplication-TileImage" content="/SRT210/img/pwa/icon-512x512.png">
<meta name="msapplication-TileColor" content="#DA291C">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><title data-rh="true">Lab 3 | SRT210 - Infrastructure Administration</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab3"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab 3 | SRT210 - Infrastructure Administration"><meta data-rh="true" name="description" content="Lab 3"><meta data-rh="true" property="og:description" content="Lab 3"><link data-rh="true" rel="icon" href="/SRT210/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab3"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab3" hreflang="en"><link data-rh="true" rel="alternate" href="https://Seneca-ICTOER.github.io//SRT210/A-Labs/lab3" hreflang="x-default"><link rel="stylesheet" href="/SRT210/assets/css/styles.099fe1a9.css">
<link rel="preload" href="/SRT210/assets/js/runtime~main.c7913e5e.js" as="script">
<link rel="preload" href="/SRT210/assets/js/main.beb789c5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/SRT210/"><div class="navbar__logo"><img src="/SRT210/img/logo.svg" alt="Seneca College" class="themedImage_ToTc themedImage--light_HNdA"><img src="/SRT210/img/logo-dark.svg" alt="Seneca College" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SRT210 - Infrastructure Administration</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SRT210/">Welcome to SRT210</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/SRT210/weekly-schedule">Weekly Schedule</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/SRT210/A-Labs/lab1">Labs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab1">Lab 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab2">Lab 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/SRT210/A-Labs/lab3">Lab 3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab4">Lab 4</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab4-part2">Lab 4 Part 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab5">Lab 5</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab6">Lab 6</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab7">Lab 7</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/SRT210/A-Labs/lab8">Lab 8</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SRT210/B-Assignments/assignment1">Assignments</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/SRT210/C-ExtraResources/first-half-review">Extra Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/SRT210/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Labs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab 3</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Lab 3</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objectives">Objectives<a class="hash-link" href="#objectives" title="Direct link to heading">​</a></h2><ul><li>Understand how port forwarding works and how it relates to security.</li><li>Set up port forwarding using iptables.</li><li>Understand fundamental concepts that make up SELinux.</li><li>Troubleshoot problems caused by SELinux.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-fix-iptables-mistakes">Part 1: Fix iptables Mistakes<a class="hash-link" href="#part-1-fix-iptables-mistakes" title="Direct link to heading">​</a></h2><p>Most of you will have experimented with iptables last week and have made mistakes, which should be fixed before you start this week&#x27;s lab. Here are some tips:</p><ul><li>You should start with the default iptables setup which you got when you installed iptables-services. If you&#x27;ve lost that - you can get it back by by putting the default values into /etc/sysconfig/iptables:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># cat /etc/sysconfig/iptables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># sample configuration for iptables service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># you can edit this manually or use system-config-firewall</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># please do not ask us to add additional ports/services to this default configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:INPUT ACCEPT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:FORWARD ACCEPT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:OUTPUT ACCEPT </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token plain">:0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p icmp -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -i lo -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -p tcp -m state --state NEW -m tcp --dport </span><span class="token number" style="color:#36acaa">22</span><span class="token plain"> -j ACCEPT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COMMIT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Then re-add the rules you created last week, and make them persistent by running <code>service iptables save</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-nat">Part 2: NAT<a class="hash-link" href="#part-2-nat" title="Direct link to heading">​</a></h2><p><a href="https://www.systutorials.com/816/port-forwarding-using-iptables/" target="_blank" rel="noopener noreferrer">This website</a> has a decent overview of port forwarding.</p><ul><li>We&#x27;ll set up your lin1 machine to be a web server accessible from the internet (in our case specifically that means accessible from the Seneca network).</li><li>Create a text file on lin1 named index.html in the /var/www/html directory with the following contents (replace Andrew with your name):</li></ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Hello, this is Andrew&#x27;s web server on lin1.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Feel free to add as much HTML in there as you like.</li><li>Confirm that:<ul><li>Apache on lin1 is running, and accessible from lin1.</li><li>It&#x27;s accessible from c7host</li></ul></li><li>Notice that if you try to access 192.168.210.11 from outside your vmware environment - there will not be a route to get to it.</li><li>Try to go to the Seneca IP address of your c7host using a web browser on your VMware host (Windows for lab machines). That should also not work but at least you should have a route to it.<ul><li>Note that if you&#x27;re using a laptop on wireless - you probably have your c7host network adapter set to NAT instead of bridged mode. If that&#x27;s the case - you might need to modify some steps from this lab.</li></ul></li><li>Now we&#x27;ll configure port forwarding so that any requests to TCP port 80 arriving at c7host will be forwarded to lin1:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># any inbound HTTP requests on ens33 are for Apache (running in linX)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A PREROUTING -t nat -i ens33 -p tcp --dport </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> -j DNAT --to </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.210.11:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># any outbound HTTP requests on ens33 (originating from linX) are returned to same linX</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -A POSTROUTING -t nat -o ens33 -p tcp -s </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.210.11 --sport </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> -j SNAT --to </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.210.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># let c7host forward packets otherwise they won&#x27;t reach linX </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iptables -I FORWARD -p tcp -d </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.210.11 --dport </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"> -j ACCEPT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Don&#x27;t just run those commands blindly - understand what they do. You can read more detail on the above rule set from <a href="https://wiki.archlinux.org/index.php/Simple_stateful_firewall" target="_blank" rel="noopener noreferrer">this website</a></li><li>Try accessing your c7host from a web browser again. You should see the web page from your lin1 web server.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nat-as-a-security-tool">NAT as a security tool<a class="hash-link" href="#nat-as-a-security-tool" title="Direct link to heading">​</a></h3><p>Note that there is plenty of nonsense on the internet, and lots of Google results will tell you that NAT is absolutely definitely not supposed to be used for securing systems online. Use your own brain to make your own decisions. I encourage you to ignore loud proclamations of fact that are missing any specific technical explanation and real-world examples.</p><p>A machine on a private subnet is not addressable from the internet. So out of the box you don&#x27;t need to worry about port scans, brute force attacks, and services that were running by default that you didn&#x27;t know about or didn&#x27;t pay attention to.</p><p>In order to allow access to a machine on a private subnet you have to make a whitelist on the router, with every explicit service that&#x27;s supposed to be accessible on your internal machine. All things being equal - a whitelist provides a greater level of security than a blacklist.</p><p>And at the end of the day if you screw up the setup of your router: the worst thing that will happen is that your internal service will be inaccessible. From a security point of view that is much better than a screwup with a firewall which can <em>make every system and service accessible</em> to <em>everyone on the internet</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="selinux-basics">SELinux Basics<a class="hash-link" href="#selinux-basics" title="Direct link to heading">​</a></h2><p>SELinux is a ridiculously complex topic. Very few people understand it fully, and you&#x27;re not expected to either. But you need at least to have a grasp of the basics and be able to debug an SELinux-related problem when it&#x27;s manifest.</p><p>We&#x27;ll use an example as an exercise to help us learn the basic concepts. The example is based on the better illustrated &quot;SELinux Practical Examples&quot; section from <a href="https://www.computernetworkingnotes.com/rhce-study-guide/selinux-explained-with-examples-in-easy-language.html" target="_blank" rel="noopener noreferrer">ComputerNetworkingNotes</a>.</p><ul><li>You should already have Apache running on lin1, and serving your custom index.html file.</li><li>If you run <code>ls -al /var/www/html</code> you&#x27;ll find that only root has write access to that directory. Let&#x27;s change that so it&#x27;s more realistic.</li><li>Use the chown command to change the ownership of the /var/www/html directory and its contents from root/root to youruser/yourgroup.</li><li>Switch to your regular user in the terminal and go to your home directory.</li><li>Create a file named copytest.html and another called movetest.html with some text inside.</li><li>Run <code>ls -lZ</code> and save the output somewhere (you can write it down in your labbook for example).</li><li>Copy copytest.html to /var/www/html and move movetest.html to the same directory.</li><li>Try to access each file from a web browser. You should be able to access one but not the other.</li><li>Check the web server error log (/var/log/httpd/error<!-- -->_<!-- -->log) - it should tell you there&#x27;s a problem with permissions.</li><li>Check your permisions with <code>ls -l</code>, they should apear to allow acces for everyone to read movetest.html<ul><li>This is a good bit of learning to absorb. When there&#x27;s a permission denied error that makes no sense - it&#x27;s quite likely that SELinux is at fault.</li></ul></li><li>Look for &quot;movetest.html&quot; in the SELinux log /var/log/audit/audit.log</li><li>You should find a line in there with the word &quot;denied&quot; in it. Instead of giving yourself a headache trying to descipher that log line, go and check the SELinux context on the files involved:<ul><li>Run <code>ls -lZ</code> on /var/www/html and compare the output to the one you saved earlier.</li></ul></li><li>The problem is the security context of the movetest.html file. Fix it using the chcon command (read <a href="https://www.computernetworkingnotes.com/rhce-study-guide/selinux-explained-with-examples-in-easy-language.html" target="_blank" rel="noopener noreferrer">the tutorial</a>).</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-your-tasks">Part 3: Your Tasks<a class="hash-link" href="#part-3-your-tasks" title="Direct link to heading">​</a></h2><p>Use what you learned so far and what you can learn online in order to set up the following:</p><ol><li>Fix any problems with your firewall from last week.</li><li>Set up access to lin1&#x27;s Apache from the Seneca network, and test it. Ideally test it with other students&#x27; help.</li><li>Set up lin2 (192.168.210.12) the same way you set up lin1. Make sure you have the firewall and networking tools installed, but you don&#x27;t need Apache on it.</li><li>Set up IPTables on c7host to forward SSH requests to port 2221 to go to the SSH server on lin1, and port 2222 to go to the ssh server on lin2.</li><li>Complete the exercise in the SELinux section of the lab.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab-completion">Lab Completion<a class="hash-link" href="#lab-completion" title="Direct link to heading">​</a></h2><ul><li>Make sure you understand what you&#x27;ve done in this lab, so that you&#x27;re ready to answer questions about it.</li><li>Have notes in your labbook from this lab.</li><li>Show your work to the professor and have them sign your labbook.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Seneca-ICTOER/SRT210/tree/main/docs/A-Labs/lab3.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/SRT210/A-Labs/lab2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Lab 2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/SRT210/A-Labs/lab4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lab 4</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objectives" class="table-of-contents__link toc-highlight">Objectives</a></li><li><a href="#part-1-fix-iptables-mistakes" class="table-of-contents__link toc-highlight">Part 1: Fix iptables Mistakes</a></li><li><a href="#part-2-nat" class="table-of-contents__link toc-highlight">Part 2: NAT</a><ul><li><a href="#nat-as-a-security-tool" class="table-of-contents__link toc-highlight">NAT as a security tool</a></li></ul></li><li><a href="#selinux-basics" class="table-of-contents__link toc-highlight">SELinux Basics</a></li><li><a href="#part-3-your-tasks" class="table-of-contents__link toc-highlight">Part 3: Your Tasks</a></li><li><a href="#lab-completion" class="table-of-contents__link toc-highlight">Lab Completion</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">SRT210 - Infrastructure Administration</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/SRT210/">Contents</a></li><li class="footer__item"><a href="#" id="pwa-button" class="footer__link-item" hidden>Install as an App</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Seneca College.</div></div></div></footer></div>
<script src="/SRT210/assets/js/runtime~main.c7913e5e.js"></script>
<script src="/SRT210/assets/js/main.beb789c5.js"></script>
</body>
</html>